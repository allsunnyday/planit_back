<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
	*변경사항*
	mapper 파일의 완전한 경로 . xml은 생략
	ibatis와는 다르게 id값에 '.'를 사용하지 못함
	namespace: 위치를 적어준다.
 -->
<mapper namespace="mybatis.Employee">

	<select id="adminIsMember" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) FROM emp WHERE e_id=#{e_id} AND pwd=#{pwd}
	</select>
	
	<select id="adminSelectOne" parameterType="java.util.Map" resultType="adminDTO">
		select e.*, d.name as deptname from emp e join dept d on e.dept_no= d.dept_no where e_id=#{e_id}
	</select>
	
	<select id="adminGetTotal" parameterType="java.util.Map" resultType="int"> 
		select count(*) from (select e.*, d.name as deptname from emp e join dept d on e.dept_no= d.dept_no)
		<if test="searchWord!=null">
				where ${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>
	</select>
	
	<select id="adminSelectList" parameterType="java.util.Map" resultType="adminDTO">
		select * from ( select T.*, rownum r from 
		(SELECT  e.*, d.name as deptname FROM emp e join dept d on e.dept_no=d.dept_no
		
		<if test="searchWord eq 'emp_no'">
			where e.${searchColumn} = #{searchWord}
		</if>
		<if test="searchWord eq 'deptname'">
			where d.name LIKE '%' || #{searchWord} || '%'
		</if>
		<if test="searchWord!=null">
			where e.${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>
		ORDER BY emp_no DESC)  T) WHERE r between #{start} and #{end}
	</select>
	
</mapper>
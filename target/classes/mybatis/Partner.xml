<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
	*변경사항*
	mapper 파일의 완전한 경로 . xml은 생략
	ibatis와는 다르게 id값에 '.'를 사용하지 못함
	namespace: 위치를 적어준다.
 -->
<mapper namespace="mybatis.Partner">
	
	<select id="descList" parameterType="java.util.Map" resultType="PartnerDTO">
		select * from
			(select a.*, rownum r from
				(select * from partner p join p_product pp on p.p_id = pp.p_id)a)
		where r between #{start} and #{end}
		order by rating desc
	</select>
	
<!-- 	<select id="ascList" parameterType="java.util.Map" resultType="PartnerDTO"> -->
<!-- 		select * from -->
<!-- 			(select a.*, rownum r from -->
<!-- 				(select * from partner p join p_product pp on p.p_id = pp.p_id)a) -->
<!-- 		where r between #{start} and #{end} -->
<!-- 		order by rating asc -->
<!-- 	</select> -->
	
	<select id="requestEvent" parameterType="java.util.Map" resultType="PartnerDTO">
		
		select * from event_request where status='accepted' order by reqdate
		 
	</select>
	
	<select id="eventList" parameterType="java.util.Map" resultType="PartnerDTO">
		select * from event_request where status='waited'  order by reqdate
	</select>
	
	<select id="eventView"  parameterType="java.util.Map" resultType="PartnerDTO">
		select * from event_request where req_no=#{req_no}
	</select>
	
	<select id="reservation" parameterType="java.util.Map" resultType="PartnerDTO">
		<if test="status != null">
			select * from p_product pp join reservation r on pp.roomcode=r.roomcode
			join planner p on p.planner_id = r.planner_id       
			<if test="status!=null">
		        	where status=#{status}
			</if>
		</if>
		
		<if test="status == null">
			select * from p_product pp join reservation r on pp.roomcode=r.roomcode
			join planner p on p.planner_id = r.planner_id 
		</if>
	</select>
	
	<select id="totalCount" parameterType="java.util.Map" resultType="Integer">
		SELECT COUNT(*) FROM event_request	
    	<if test="searchColumn !=null">
    		WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
    	</if>	
	</select>
	
	<update id="successUpdate" parameterType="java.util.Map">
		update event_request set status='accepted', reqdate=sysdate where req_no=#{req_no}	
	</update>

</mapper>